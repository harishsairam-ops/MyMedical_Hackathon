<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetScan Pro: Local Animal Health Risk</title>
    <!-- Load Tailwind CSS for modern styling and responsiveness -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for appearance */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f8ff 0%, #e0e7ff 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column; 
            padding-top: 4.5rem; /* Space for fixed navbar */
        }
        .container-card {
            box-shadow: 0 20px 50px rgba(17, 24, 39, 0.15);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .input-box {
            transition: all 0.3s ease-in-out;
            border-color: #d1d5db; 
        }
        .input-box:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        .btn-check, .btn-primary {
            transition: background-color 0.3s, transform 0.1s, box-shadow 0.3s;
        }
        .btn-check:hover, .btn-primary:hover {
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }
        .btn-check:active, .btn-primary:active {
            transform: scale(0.98);
        }
        /* Style for the select arrow */
        select {
          -webkit-appearance: none;
          -moz-appearance: none;
          appearance: none;
          background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%234B5563" d="M7 10l5 5 5-5z"/></svg>');
          background-repeat: no-repeat;
          background-position: right 10px center;
          padding-right: 30px;
        }

        /* --- Custom Animations for Home Page "WOW" factor --- */
        @keyframes float-move {
            0% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(20px, -10px) scale(1.05); }
            100% { transform: translate(0, 0) scale(1); }
        }

        .floating-blob-1 {
            background: rgba(59, 130, 246, 0.15); /* Blue */
            animation: float-move 10s ease-in-out infinite alternate;
            filter: blur(50px);
        }
        .floating-blob-2 {
            background: rgba(168, 85, 247, 0.15); /* Purple */
            animation: float-move 12s ease-in-out infinite reverse;
            filter: blur(60px);
        }

        /* Loading Spinner Animation */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: #ffffff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Active Navbar Link Styling */
        .nav-link.active {
            color: #2563eb !important; /* Blue-600 */
            font-weight: 700;
            background-color: #eff6ff; /* Blue-50 */
            border-radius: 0.375rem;
        }
    </style>
</head>
<body class="p-0">

    <!-- NAVBAR -->
    <nav class="fixed top-0 left-0 w-full bg-white shadow-lg z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo/Title -->
                <div class="flex-shrink-0">
                    <button onclick="showPage('home-page')" class="text-2xl font-bold text-blue-700 hover:text-blue-500 transition-colors">
                        PetScan Pro
                    </button>
                </div>
                <!-- Navigation Links -->
                <div class="flex space-x-2 sm:space-x-4">
                    <button id="nav-home-page" onclick="showPage('home-page')" class="nav-link text-gray-600 hover:text-blue-600 font-medium px-3 py-2 rounded-md transition-colors">Home</button>
                    <button id="nav-scanner-page" onclick="showPage('scanner-page')" class="nav-link text-gray-600 hover:text-blue-600 font-medium px-3 py-2 rounded-md transition-colors">Scanner</button>
                    <button id="nav-about-us-page" onclick="showPage('about-us-page')" class="nav-link text-gray-600 hover:text-blue-600 font-medium px-3 py-2 rounded-md transition-colors">About Us</button>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- MAIN CONTENT WRAPPER -->
    <main class="flex-grow p-4 flex justify-center w-full">
        <div class="w-full max-w-xl">

            <!-- HOME PAGE (TRUST & DATA FOCUSED REDESIGN) -->
            <div id="home-page" class="container-card w-full bg-white p-6 md:p-10 mt-4 rounded-3xl relative overflow-hidden">
                
                <!-- Animated Background Blobs -->
                <div class="floating-blob-1 absolute w-64 h-64 rounded-full -top-10 -left-10 z-0 opacity-70"></div>
                <div class="floating-blob-2 absolute w-72 h-72 rounded-full -bottom-10 -right-10 z-0 opacity-70"></div>
                

                <div class="relative z-10 text-center">
                    <!-- Hero Section -->
                    <div class="p-4 sm:p-8 rounded-2xl bg-gradient-to-br from-blue-600 to-blue-800 text-white shadow-xl mb-8">
                        <svg class="w-16 h-16 mx-auto mb-4 text-blue-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c1.657 0 3 .895 3 2s-1.343 2-3 2-3-.895-3-2 1.343-2 3-2zM9 14h6m-6 2h6m-3-10a9 9 0 019 9c0 5.483-4.5 9.98-9 9.98S3 17.483 3 12a9 9 0 019-9z"></path></svg>
                        <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight mb-2">
                            Veterinary Public Health Risk Assessment
                        </h1>
                        <p class="text-lg font-light text-blue-200">
                            Proactively protect your pet using real-time, localized disease data.
                        </p>
                    </div>
                    
                    <!-- Call to Action -->
                    <div class="mb-10">
                        <p class="text-xl font-medium leading-relaxed text-gray-700 mb-6">
                            Enter your location and pet type to instantly check for **active local outbreaks, parasitic threats, and environmental risks.**
                        </p>
                        <button onclick="showPage('scanner-page')" class="btn-primary w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl shadow-2xl flex items-center justify-center text-xl transition-all duration-300 transform hover:scale-[1.01] tracking-wider">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
                            Run Local Risk Scan Now
                        </button>
                    </div>

                    <!-- Statistics / Trust Section -->
                    <div class="grid grid-cols-3 gap-4 text-gray-800 border-t pt-6 mt-6 border-gray-200">
                        <div class="p-3 rounded-lg bg-gray-50">
                            <p class="text-3xl font-extrabold text-blue-700">100+</p>
                            <p class="text-xs font-semibold uppercase text-gray-500 mt-1">Verified Sources</p>
                        </div>
                        <div class="p-3 rounded-lg bg-gray-50">
                            <p class="text-3xl font-extrabold text-blue-700">Live</p>
                            <p class="text-xs font-semibold uppercase text-gray-500 mt-1">Data Grounding</p>
                        </div>
                        <div class="p-3 rounded-lg bg-gray-50">
                            <p class="text-3xl font-extrabold text-blue-700">4+</p>
                            <p class="text-xs font-semibold uppercase text-gray-500 mt-1">Pet Species</p>
                        </div>
                    </div>
                    
                    <!-- Core Services (Features integrated) -->
                    <h2 class="text-2xl font-extrabold text-gray-800 text-center mt-12 mb-6">How We Keep Your Pet Safe</h2>
                    <div class="space-y-6">
                        <!-- Feature 1: Localized Data -->
                        <div class="flex items-start space-x-4 p-4 border border-gray-100 rounded-xl bg-green-50 shadow-sm">
                            <svg class="w-8 h-8 flex-shrink-0 text-green-600 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0zM15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">Hyper-Local Risk Assessment</h3>
                                <p class="text-gray-600">We analyze data specific to your **city or area** to identify relevant disease outbreaks and localized threats, offering maximum accuracy.</p>
                            </div>
                        </div>

                        <!-- Feature 2: Real-Time Grounding -->
                        <div class="flex items-start space-x-4 p-4 border border-gray-100 rounded-xl bg-blue-50 shadow-sm">
                            <svg class="w-8 h-8 flex-shrink-0 text-blue-600 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path></svg>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">AI-Powered Data Synthesis</h3>
                                <p class="text-gray-600">We use AI, grounded by Google Search, to instantly analyze vast veterinary public health reports and synthesize them into a concise, actionable report.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SCANNER PAGE -->
            <div id="scanner-page" class="container-card w-full bg-white p-6 md:p-10 mt-4 rounded-3xl hidden opacity-0">
                <h1 class="text-3xl font-extrabold text-center text-blue-700 mb-2">Pet Health Risk Assessment</h1>
                <p class="text-center text-sm text-gray-500 mb-8">
                    Enter your location and animal type to get a personalized report.
                </p>

                <!-- Input Form -->
                <div class="space-y-6">
                    <div>
                        <label for="locationInput" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                            <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            City/Area Name
                        </label>
                        <input type="text" id="locationInput" placeholder="e.g., London, UK or Bengaluru, IN" class="input-box w-full p-3 border border-gray-300 rounded-xl bg-gray-50" value="Tambaram">
                    </div>

                    <div>
                        <label for="animalInput" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                            <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5V3m0 18v-2m-7-6H3m18 0h-2M5.636 5.636l1.414 1.414M16.95 16.95l1.414 1.414M6.343 17.657l-1.414-1.414M17.657 6.343l-1.414-1.414"></path></svg>
                            Animal Type
                        </label>
                        <div class="relative">
                            <select id="animalInput" class="input-box w-full p-3 border border-gray-300 rounded-xl bg-gray-50">
                                <option value="cat">Cat</option>
                                <option value="dog">Dog</option>
                                <option value="rabbit">Rabbit</option>
                                <option value="horse">Horse</option>
                            </select>
                        </div>
                    </div>

                    <button id="checkButton" onclick="getDiseaseRisk()" class="btn-check w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl shadow-lg flex items-center justify-center">
                        Check Disease Risk
                    </button>
                </div>

                <!-- Results Area -->
                <div id="results" class="mt-10 pt-6 border-t border-blue-100">
                    <!-- Results will appear here -->
                    <p class="text-center text-gray-500 italic p-4">Enter your details and click 'Check Risk' to generate a report.</p>
                </div>
            </div>

            <!-- ABOUT US PAGE -->
            <div id="about-us-page" class="container-card w-full bg-white p-8 md:p-12 mt-4 rounded-3xl hidden opacity-0">
                <h2 class="text-3xl font-extrabold text-center text-indigo-700 mb-8">Our Mission: Proactive Pet Health</h2>
                
                <div class="space-y-6 text-gray-700">
                    <p class="text-lg leading-relaxed">
                        At **PetScan Pro**, we believe that informed pet owners are the best pet owners. We created this tool to bridge the gap between complex veterinary public health data and the everyday needs of pet families. Our system leverages advanced AI and real-time data integration to deliver localized, actionable risk assessments.
                    </p>
                    <div class="border-l-4 border-indigo-400 pl-4 py-2 bg-indigo-50 rounded-r-lg">
                        <p class="font-semibold text-indigo-800 italic">
                            "Our goal is to eliminate uncertainty and provide the confidence needed to ensure the well-being of your beloved animals."
                        </p>
                    </div>
                    <h3 class="text-xl font-bold pt-4 text-blue-600">How It Works</h3>
                    <p>
                        We utilize Google Search grounding to scan reputable sources, including government reports, university veterinary journals, and local health alerts, specifically focusing on the geographic region and animal type you provide. This ensures that the risk assessment is not only accurate but also **highly localized and current.**
                    </p>
                    <h3 class="text-xl font-bold pt-4 text-blue-600">The Team</h3>
                    <p>
                        We are a small team of data scientists, veterinarians, and software developers passionate about animal welfare. This platform is continuously updated and refined based on the latest advancements in veterinary science and technology.
                    </p>
                </div>
            </div>
            
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="bg-gray-800 text-white mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center md:flex md:justify-between md:items-center">
            <div class="mb-4 md:mb-0">
                <h4 class="text-xl font-semibold">PetScan Pro</h4>
                <p class="text-sm text-gray-400">Local Health Intelligence for your Pets</p>
            </div>
            <div class="flex justify-center space-x-6">
                <a href="#" class="text-gray-400 hover:text-white transition-colors text-sm">Privacy Policy</a>
                <a href="#" class="text-gray-400 hover:text-white transition-colors text-sm">Terms of Service</a>
                <button onclick="showPage('about-us-page')" class="text-gray-400 hover:text-white transition-colors text-sm">Contact</button>
            </div>
            <div class="mt-4 md:mt-0 text-gray-500 text-sm">
                &copy; 2024 PetScan Pro. All rights reserved.
            </div>
        </div>
    </footer>

    <script>
        // --- 1. State and UI Control ---
        const ALL_PAGES = ['home-page', 'scanner-page', 'about-us-page'];
        
        document.addEventListener('DOMContentLoaded', () => {
            showPage('home-page');
        });

        /**
         * Simple single-page routing logic with a fade transition and active link highlighting.
         */
        function showPage(pageId) {
            ALL_PAGES.forEach(id => {
                const page = document.getElementById(id);
                // Check for navigation links using the 'nav-' prefix
                const navLink = document.getElementById(`nav-${id}`);

                if (page) {
                    // Page visibility and fade transition
                    if (id === pageId) {
                        page.classList.remove('hidden');
                        setTimeout(() => {
                            page.classList.remove('opacity-0');
                            page.classList.add('opacity-100');
                        }, 10);
                    } else {
                        page.classList.remove('opacity-100');
                        page.classList.add('opacity-0');
                        setTimeout(() => {
                            page.classList.add('hidden');
                        }, 500);
                    }
                }
                
                // Active link highlighting
                if (navLink) {
                    navLink.classList.toggle('active', id === pageId);
                }
            });
        }

        // --- 2. Gemini API Configuration ---
        const apiKey = "AIzaSyDXnxB5iafTlL4aXRf-8miti7Lrd1aKahE"; // API key is automatically provided in this environment
        const apiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent';

        // --- 3. Core Functions ---

        /**
         * Generic fetch utility with exponential backoff for resilience.
         */
        async function fetchWithExponentialBackoff(url, options, maxRetries = 3) {
            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    if (attempt === maxRetries - 1) {
                        console.error('API call failed after all retries:', error);
                        throw new Error('Could not connect to the external data service. Please try again later.');
                    }
                    const delay = Math.pow(2, attempt) * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        /**
         * Determines the color and label for the risk badge.
         */
        function getRiskDetails(risk) {
            const upperRisk = risk.toUpperCase();
            if (upperRisk.includes('HIGH')) {
                return { label: 'HIGH RISK', color: 'bg-red-500', icon: '🚨' };
            }
            if (upperRisk.includes('MEDIUM')) {
                return { label: 'MEDIUM RISK', color: 'bg-yellow-500', icon: '⚠️' };
            }
            return { label: 'LOW RISK', color: 'bg-green-500', icon: '✅' };
        }
        
        /**
         * Parses the detailed body into structured disease objects for better display.
         */
        function parseReportBody(reportBody) {
            const paragraphs = reportBody.split(/\n{2,}|\<br\>\<br\>/).map(p => p.trim()).filter(p => p.length > 0);
            const diseases = [];

            paragraphs.forEach(p => {
                // Try to extract disease name and risk level from the paragraph
                const matchName = p.match(/^([A-Za-z0-9\s-]+) is noted/i) || p.match(/^(?:Disease: )?([A-Za-z0-9\s-]+)[:.]/i);
                const matchRisk = p.match(/(High|Medium|Low) Risk/i);

                let diseaseName = matchName ? matchName[1].trim() : 'Unknown Disease';
                const riskLevel = matchRisk ? matchRisk[1] : 'Unknown';
                const description = p;

                // Simple cleanup
                if (diseaseName.includes('.')) {
                    diseaseName = diseaseName.substring(0, diseaseName.indexOf('.')).trim();
                }

                diseases.push({ diseaseName, riskLevel, description });
            });

            return diseases;
        }


        /**
         * Fetches disease data using Gemini API with Google Search grounding.
         */
        async function fetchDiseaseDataFromGemini(animal, location) {
            const systemPrompt = `You are a specialized Veterinary Public Health Analyst. Your task is to provide an overall summary risk level (High, Medium, or Low) in the first sentence of your response, followed by a detailed, factual summary of the top 3-5 high-risk and most prevalent diseases (viral, bacterial, parasitic) affecting ${animal} in the specific region of ${location}. Base your findings ONLY on current public health reports, government veterinary databases, and major, reputable local veterinary news sources found via search. 
                                  For example, start the response with: 'The overall disease risk for a ${animal} in ${location} is [HIGH/MEDIUM/LOW] due to [brief reason].' 
                                  After the first summary sentence, create a separate, concise paragraph for each disease, with each disease name clearly stated, followed by its Risk Level (High, Medium, Low), and a brief, specific local prevalence note. Use clear, easy-to-read language suitable for a pet owner. Separate these disease paragraphs with a double line break (\\n\\n). Do NOT use markdown headings, bullet points, or tables.`;
            
            const userQuery = `Summarize the major current animal disease risks for ${animal} in ${location}.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            const urlWithKey = `${apiUrl}?key=${apiKey}`;

            const options = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            };

            const response = await fetchWithExponentialBackoff(urlWithKey, options);
            return response.json();
        }

        /**
         * Main function to handle user interaction and data fetching.
         */
        async function getDiseaseRisk() {
            const locationInput = document.getElementById('locationInput').value.trim();
            const animalInput = document.getElementById('animalInput').value.trim();
            const resultsDiv = document.getElementById('results');
            const checkButton = document.getElementById('checkButton');
            
            resultsDiv.innerHTML = '';
            
            if (!locationInput || !animalInput) {
                displayMessage(resultsDiv, "Please enter a valid city/area and select an animal.", 'bg-red-100 text-red-700 border-red-300');
                return;
            }

            // 1. Show Loading State
            checkButton.disabled = true;
            checkButton.innerHTML = '<span class="spinner"></span> Generating Report...';
            resultsDiv.innerHTML = ''; 

            try {
                // 2. Fetch Data
                const result = await fetchDiseaseDataFromGemini(animalInput, locationInput);
                const candidate = result.candidates?.[0];

                if (!candidate || !candidate.content?.parts?.[0]?.text) {
                     throw new Error("The risk checker could not generate a valid report.");
                }

                const fullText = candidate.content.parts[0].text;
                let sources = [];
                const groundingMetadata = candidate.groundingMetadata;

                if (groundingMetadata && groundingMetadata.groundingAttributions) {
                    sources = groundingMetadata.groundingAttributions
                        .map(attribution => ({
                            uri: attribution.web?.uri,
                            title: attribution.web?.title,
                        }))
                        .filter(source => source.uri && source.title);
                }
                
                // 3. Extract Risk Level and Report Body
                const sentences = fullText.split('. ');
                const overallRiskSentence = sentences.shift();
                const reportBody = sentences.join('. ').trim();
                
                const { label, color, icon } = getRiskDetails(overallRiskSentence);
                const diseases = parseReportBody(reportBody);

                // 4. Display Results
                let resultsHTML = `
                    <div class="flex flex-col sm:flex-row items-center justify-between mb-6 border-b pb-2 border-blue-200">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-2 sm:mb-0">
                            <span class="text-blue-600">Report:</span> ${animalInput} in ${locationInput}
                        </h2>
                        <span class="px-5 py-2 text-md font-bold text-white rounded-full ${color} shadow-lg transform hover:scale-105 transition-transform duration-200">
                            ${icon} ${label}
                        </span>
                    </div>
                `;
                
                // Display Generated Text (Overall Summary)
                resultsHTML += `<div class="p-4 bg-blue-50 border border-blue-300 rounded-xl shadow-inner mb-6 text-gray-800 font-medium text-lg leading-relaxed">
                                    <p class="font-bold text-blue-800 mb-2">Overall Assessment:</p>
                                    <p>${overallRiskSentence}.</p>
                                </div>`;

                // Display Detailed Disease Cards
                if (diseases.length > 0) {
                     resultsHTML += `<h3 class="text-xl font-extrabold text-gray-800 mb-4 border-b pb-2">Top Disease Threats:</h3>`;
                     diseases.forEach(d => {
                        const { label: dLabel, color: dColor } = getRiskDetails(d.riskLevel);
                        resultsHTML += `
                            <div class="p-4 mb-4 border border-gray-200 rounded-xl shadow-md bg-white hover:shadow-lg transition-shadow duration-300">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="text-lg font-bold text-gray-800">${d.diseaseName}</h4>
                                    <span class="text-xs font-semibold px-3 py-1 rounded-full text-white ${dColor}">${dLabel}</span>
                                </div>
                                <p class="text-gray-600 text-sm leading-relaxed">${d.description}</p>
                            </div>
                        `;
                    });
                }


                // Display Sources
                if (sources.length > 0) {
                    resultsHTML += `<h3 class="text-md font-semibold text-gray-600 mt-8 mb-3 border-b border-gray-100 pb-1">Sources Referenced:</h3>`;
                    resultsHTML += `<ul class="list-disc list-outside text-sm text-gray-600 space-y-2 p-4 bg-gray-100 rounded-xl shadow-inner">`;
                    sources.slice(0, 5).forEach((source) => {
                        resultsHTML += `<li class="ml-4"><a href="${source.uri}" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium break-words">${source.title}</a></li>`;
                    });
                    resultsHTML += `</ul>`;
                } else {
                    resultsHTML += `<p class="text-sm text-gray-400 italic mt-8 p-3 bg-gray-50 rounded-lg">No specific web sources were cited for this report. The summary relies on general knowledge base.</p>`;
                }
                
                resultsDiv.innerHTML = resultsHTML;

            } catch (error) {
                console.error("Error in getDiseaseRisk:", error);
                const errorMessage = error.message.includes('Could not connect') 
                    ? error.message 
                    : "An unexpected error occurred while fetching data. Please refine your search and try again.";
                displayMessage(resultsDiv, `🚨 Error: ${errorMessage}`, 'bg-red-100 text-red-700 border-red-300');
            } finally {
                // 4. Restore Button State
                checkButton.disabled = false;
                checkButton.innerHTML = 'Check Disease Risk';
            }
        }

        /**
         * Helper function to display messages to the user.
         */
        function displayMessage(element, message, classString) {
            element.innerHTML = `<p class="p-4 text-center rounded-xl border ${classString} font-medium">${message}</p>`;
        }
    </script>
</body>
</html>
